{
  "groups": [
    {
      "id": "tables",
      "name": "Tables",
      "icon": "table",
      "itemsSource": {
        "type": "sql",
        "value": "SELECT schemaname AS schema, tablename AS name FROM pg_tables WHERE schemaname = 'public' ORDER BY tablename"
      },
      "itemTemplate": {
        "id": ":schema.:name",
        "icon": "table",
        "name": ":name",
        "visible": true,
        "autoRun": true,
        "queries": [
          {
            "source": {
              "type": "sql",
              "value": "SELECT * FROM \":schema\".\":name\" LIMIT 100"
            },
            "results": "table"
          }
        ]
      }
    },
    {
      "id": "admin",
      "name": "Admin",
      "icon": "settings",
      "items": [
        {
          "id": "cron",
          "name": "Cron",
          "icon": "clock",
          "visible": true,
          "autoRun": true,
          "queries": [
            {
              "source": {
                "type": "sql",
                "value": "SELECT jobid, jobname, schedule, command, active FROM cron.job ORDER BY jobname"
              },
              "results": "table",
              "rowActions": [
                {
                  "label": "Edit",
                  "itemId": "edit",
                  "params": { "jobid": "jobid" }
                },
                {
                  "label": "Delete",
                  "itemId": "delete",
                  "params": { "jobid": "jobid" },
                  "variant": "destructive"
                }
              ]
            }
          ],
          "primaryAction": {
            "label": "Create Job",
            "itemId": "create"
          },
          "children": [
            {
              "id": "create",
              "name": "Create Job",
              "visible": false,
              "queries": [
                {
                  "source": {
                    "type": "sql",
                    "value": "SELECT cron.schedule(':jobname', ':schedule', ':command')"
                  },
                  "returnToParent": true,
                  "results": null,
                  "parameters": [
                    {
                      "name": "jobname",
                      "label": "Job Name",
                      "type": "text",
                      "required": true,
                      "placeholder": "my-cron-job"
                    },
                    {
                      "name": "schedule",
                      "label": "Schedule",
                      "type": "text",
                      "required": true,
                      "placeholder": "*/5 * * * *"
                    },
                    {
                      "name": "command",
                      "label": "Command",
                      "type": "textarea",
                      "required": true,
                      "placeholder": "SELECT my_function()"
                    }
                  ]
                }
              ]
            },
            {
              "id": "edit",
              "name": "Edit Job",
              "visible": false,
              "queries": [
                {
                  "source": {
                    "type": "sql",
                    "value": "UPDATE cron.job SET jobname = :jobname, schedule = :schedule, command = :command, active = :active WHERE jobid = :jobid"
                  },
                  "loader": {
                    "type": "sql",
                    "value": "SELECT * FROM cron.job WHERE jobid = :jobid"
                  },
                  "returnToParent": true,
                  "results": null,
                  "parameters": [
                    {
                      "name": "jobname",
                      "label": "Job Name",
                      "type": "text",
                      "required": true
                    },
                    {
                      "name": "schedule",
                      "label": "Schedule",
                      "type": "text",
                      "required": true
                    },
                    {
                      "name": "command",
                      "label": "Command",
                      "type": "textarea",
                      "required": true
                    },
                    { "name": "active", "label": "Active", "type": "boolean" }
                  ]
                }
              ]
            },
            {
              "id": "delete",
              "name": "Delete Job",
              "visible": false,
              "queries": [
                {
                  "source": {
                    "type": "sql",
                    "value": "SELECT cron.unschedule(:jobid)"
                  },
                  "loader": {
                    "type": "sql",
                    "value": "SELECT * FROM cron.job WHERE jobid = :jobid"
                  },
                  "returnToParent": true,
                  "results": null,
                  "parameters": [
                    {
                      "name": "jobid",
                      "label": "Job ID",
                      "type": "text",
                      "required": true
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "id": "users",
          "name": "Users",
          "icon": "contact",
          "visible": true,
          "autoRun": true,
          "queries": [
            {
              "source": {
                "type": "sql",
                "value": "SELECT d.date::date as date, count(u.id) as count FROM generate_series(date_trunc('week', current_date - interval '3 months'), date_trunc('week', current_date), '1 week'::interval) as d(date) LEFT JOIN auth.users u ON date_trunc('week', u.created_at)::date = d.date::date GROUP BY 1 ORDER BY 1"
              },
              "results": "chart",
              "chart": {
                "xAxis": {
                  "name": "date",
                  "label": "Date"
                },
                "yAxis": [
                  {
                    "name": "count",
                    "label": "Users"
                  }
                ]
              }
            },
            {
              "source": {
                "type": "sql",
                "value": "SELECT id, email, created_at, last_sign_in_at FROM auth.users ORDER BY created_at DESC LIMIT 50"
              },
              "results": "table"
            }
          ]
        },
        {
          "id": "resend",
          "name": "Resend Contacts",
          "icon": "mail",
          "visible": true,
          "autoRun": true,
          "queries": [
            {
              "source": {
                "type": "edge_function",
                "name": "resend/contacts",
                "value": "{\n  \"method\": \"GET\"\n}"
              },
              "results": "table",
              "rowActions": [
                {
                  "label": "Edit",
                  "itemId": "edit-contact",
                  "params": { "id": "id" }
                },
                {
                  "label": "Delete",
                  "itemId": "delete-contact",
                  "params": { "id": "id" },
                  "variant": "destructive"
                }
              ]
            }
          ],
          "primaryAction": {
            "label": "Add Contact",
            "itemId": "create-contact"
          },
          "children": [
            {
              "id": "create-contact",
              "name": "Add Contact",
              "visible": false,
              "queries": [
                {
                  "source": {
                    "type": "edge_function",
                    "name": "resend/contacts",
                    "value": "{\n  \"method\": \"POST\",\n  \"body\": {\n    \"email\": \":email\",\n    \"first_name\": \":first_name\",\n    \"last_name\": \":last_name\"\n  }\n}"
                  },
                  "returnToParent": true,
                  "results": null,
                  "parameters": [
                    {
                      "name": "email",
                      "label": "Email",
                      "type": "text",
                      "required": true
                    },
                    {
                      "name": "first_name",
                      "label": "First Name",
                      "type": "text",
                      "required": true
                    },
                    {
                      "name": "last_name",
                      "label": "Last Name",
                      "type": "text",
                      "required": true
                    }
                  ]
                }
              ]
            },
            {
              "id": "edit-contact",
              "name": "Edit Contact",
              "visible": false,
              "autoRun": true,
              "queries": [
                {
                  "source": {
                    "type": "edge_function",
                    "name": "resend/contacts/:id",
                    "value": "{\n  \"method\": \"PATCH\",\n  \"body\": {\n    \"firstName\": \":first_name\",\n    \"lastName\": \":last_name\",\n    \"unsubscribed\": :unsubscribed\n  }\n}"
                  },
                  "loader": {
                    "type": "edge_function",
                    "name": "resend/contacts/:id",
                    "value": "{\n  \"method\": \"GET\"\n}"
                  },
                  "returnToParent": true,
                  "results": null,
                  "parameters": [
                    {
                      "name": "first_name",
                      "label": "First Name",
                      "type": "text",
                      "required": true
                    },
                    {
                      "name": "last_name",
                      "label": "Last Name",
                      "type": "text",
                      "required": true
                    },
                    {
                      "name": "unsubscribed",
                      "label": "Unsubscribed",
                      "type": "boolean",
                      "required": true
                    }
                  ]
                }
              ]
            },
            {
              "id": "delete-contact",
              "name": "Delete Contact",
              "visible": false,
              "queries": [
                {
                  "source": {
                    "type": "edge_function",
                    "name": "resend/contacts/:id",
                    "value": "{\n  \"method\": \"DELETE\"\n}"
                  },
                  "loader": {
                    "type": "edge_function",
                    "name": "resend/contacts/:id",
                    "value": "{\n  \"method\": \"GET\"\n}"
                  },
                  "returnToParent": true,
                  "results": null,
                  "parameters": [
                    {
                      "name": "id",
                      "label": "Contact ID",
                      "type": "text",
                      "required": true,
                      "hidden": true
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "id": "resend-templates",
          "name": "Resend Templates",
          "icon": "layout-template",
          "visible": true,
          "autoRun": true,
          "queries": [
            {
              "source": {
                "type": "edge_function",
                "name": "resend/templates",
                "value": "{\n  \"method\": \"GET\"\n}"
              },
              "results": "table"
            }
          ]
        },
        {
          "id": "functions",
          "name": "Functions",
          "icon": "function-square",
          "visible": true,
          "autoRun": true,
          "queries": [
            {
              "source": {
                "type": "sql",
                "value": "SELECT p.proname AS name, n.nspname AS schema, pg_get_function_result(p.oid) AS return_type, pg_get_function_arguments(p.oid) AS arguments, CASE p.prokind WHEN 'f' THEN 'function' WHEN 'p' THEN 'procedure' WHEN 'a' THEN 'aggregate' WHEN 'w' THEN 'window' END AS kind FROM pg_proc p JOIN pg_namespace n ON p.pronamespace = n.oid WHERE n.nspname = ':schema' ORDER BY p.proname"
              },
              "results": "table",
              "parameters": [
                {
                  "name": "schema",
                  "label": "Schema",
                  "type": "text",
                  "required": true,
                  "default": "public"
                }
              ],
              "rowActions": [
                {
                  "label": "View",
                  "itemId": "view",
                  "params": { "name": "name", "schema": "schema" }
                },
                {
                  "label": "Delete",
                  "itemId": "delete",
                  "params": { "name": "name", "schema": "schema", "arguments": "arguments" },
                  "variant": "destructive"
                }
              ]
            }
          ],
          "primaryAction": {
            "label": "Create Function",
            "itemId": "create"
          },
          "children": [
            {
              "id": "create",
              "name": "Create Function",
              "visible": false,
              "queries": [
                {
                  "source": {
                    "type": "sql",
                    "value": "CREATE OR REPLACE FUNCTION \":schema\".\":name\"(:arguments) RETURNS :return_type LANGUAGE :language SECURITY :security AS $$ :body $$"
                  },
                  "returnToParent": true,
                  "results": null,
                  "parameters": [
                    {
                      "name": "schema",
                      "label": "Schema",
                      "type": "text",
                      "required": true,
                      "default": "public"
                    },
                    {
                      "name": "name",
                      "label": "Function Name",
                      "type": "text",
                      "required": true,
                      "placeholder": "my_function"
                    },
                    {
                      "name": "arguments",
                      "label": "Arguments",
                      "type": "text",
                      "required": false,
                      "placeholder": "arg1 text, arg2 integer"
                    },
                    {
                      "name": "return_type",
                      "label": "Return Type",
                      "type": "select",
                      "required": true,
                      "default": "void",
                      "options": [
                        { "value": "void", "label": "void" },
                        { "value": "text", "label": "text" },
                        { "value": "integer", "label": "integer" },
                        { "value": "bigint", "label": "bigint" },
                        { "value": "boolean", "label": "boolean" },
                        { "value": "json", "label": "json" },
                        { "value": "jsonb", "label": "jsonb" },
                        { "value": "uuid", "label": "uuid" },
                        { "value": "timestamp", "label": "timestamp" },
                        { "value": "timestamptz", "label": "timestamptz" },
                        { "value": "trigger", "label": "trigger" },
                        { "value": "record", "label": "record" },
                        { "value": "SETOF record", "label": "SETOF record" }
                      ]
                    },
                    {
                      "name": "language",
                      "label": "Language",
                      "type": "select",
                      "required": true,
                      "default": "plpgsql",
                      "options": [
                        { "value": "plpgsql", "label": "PL/pgSQL" },
                        { "value": "sql", "label": "SQL" }
                      ]
                    },
                    {
                      "name": "security",
                      "label": "Security",
                      "type": "select",
                      "required": true,
                      "default": "INVOKER",
                      "options": [
                        { "value": "INVOKER", "label": "Invoker" },
                        { "value": "DEFINER", "label": "Definer" }
                      ]
                    },
                    {
                      "name": "body",
                      "label": "Function Body",
                      "type": "textarea",
                      "required": true,
                      "placeholder": "BEGIN\n  -- Your code here\n  RETURN;\nEND;"
                    }
                  ]
                }
              ]
            },
            {
              "id": "view",
              "name": "View Function",
              "visible": false,
              "autoRun": true,
              "queries": [
                {
                  "source": {
                    "type": "sql",
                    "value": "SELECT p.proname AS name, n.nspname AS schema, pg_get_function_result(p.oid) AS return_type, pg_get_function_arguments(p.oid) AS arguments, CASE p.prokind WHEN 'f' THEN 'function' WHEN 'p' THEN 'procedure' WHEN 'a' THEN 'aggregate' WHEN 'w' THEN 'window' END AS kind, l.lanname AS language, CASE WHEN p.prosecdef THEN 'SECURITY DEFINER' ELSE 'SECURITY INVOKER' END AS security, pg_get_functiondef(p.oid) AS definition FROM pg_proc p JOIN pg_namespace n ON p.pronamespace = n.oid JOIN pg_language l ON p.prolang = l.oid WHERE n.nspname = ':schema' AND p.proname = ':name'"
                  },
                  "results": "table"
                }
              ]
            },
            {
              "id": "delete",
              "name": "Delete Function",
              "visible": false,
              "queries": [
                {
                  "source": {
                    "type": "sql",
                    "value": "DROP FUNCTION \":schema\".\":name\"(:arguments)"
                  },
                  "loader": {
                    "type": "sql",
                    "value": "SELECT ':schema' AS schema, ':name' AS name, ':arguments' AS arguments"
                  },
                  "returnToParent": true,
                  "results": null,
                  "parameters": [
                    {
                      "name": "schema",
                      "label": "Schema",
                      "type": "text",
                      "required": true,
                      "hidden": true
                    },
                    {
                      "name": "name",
                      "label": "Function Name",
                      "type": "text",
                      "required": true,
                      "hidden": true
                    },
                    {
                      "name": "arguments",
                      "label": "Arguments",
                      "type": "text",
                      "required": true,
                      "hidden": true
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "id": "triggers",
          "name": "Triggers",
          "icon": "zap",
          "visible": true,
          "autoRun": true,
          "queries": [
            {
              "source": {
                "type": "sql",
                "value": "SELECT t.tgname AS name, n.nspname AS schema, c.relname AS table_name, CASE t.tgtype & 1 WHEN 1 THEN 'ROW' ELSE 'STATEMENT' END AS level, CASE WHEN t.tgtype & 2 > 0 THEN 'BEFORE' WHEN t.tgtype & 64 > 0 THEN 'INSTEAD OF' ELSE 'AFTER' END AS timing, ARRAY_TO_STRING(ARRAY[ CASE WHEN t.tgtype & 4 > 0 THEN 'INSERT' END, CASE WHEN t.tgtype & 8 > 0 THEN 'DELETE' END, CASE WHEN t.tgtype & 16 > 0 THEN 'UPDATE' END, CASE WHEN t.tgtype & 32 > 0 THEN 'TRUNCATE' END ], ' OR ') AS events, p.proname AS function_name, t.tgenabled AS enabled FROM pg_trigger t JOIN pg_class c ON t.tgrelid = c.oid JOIN pg_namespace n ON c.relnamespace = n.oid JOIN pg_proc p ON t.tgfoid = p.oid WHERE NOT t.tgisinternal AND n.nspname = ':schema' ORDER BY t.tgname"
              },
              "results": "table",
              "parameters": [
                {
                  "name": "schema",
                  "label": "Schema",
                  "type": "text",
                  "required": true,
                  "default": "public"
                }
              ],
              "rowActions": [
                {
                  "label": "View",
                  "itemId": "view",
                  "params": { "name": "name", "schema": "schema", "table_name": "table_name" }
                },
                {
                  "label": "Delete",
                  "itemId": "delete",
                  "params": { "name": "name", "schema": "schema", "table_name": "table_name" },
                  "variant": "destructive"
                }
              ]
            }
          ],
          "children": [
            {
              "id": "view",
              "name": "View Trigger",
              "visible": false,
              "autoRun": true,
              "queries": [
                {
                  "source": {
                    "type": "sql",
                    "value": "SELECT t.tgname AS name, n.nspname AS schema, c.relname AS table_name, CASE t.tgtype & 1 WHEN 1 THEN 'ROW' ELSE 'STATEMENT' END AS level, CASE WHEN t.tgtype & 2 > 0 THEN 'BEFORE' WHEN t.tgtype & 64 > 0 THEN 'INSTEAD OF' ELSE 'AFTER' END AS timing, ARRAY_TO_STRING(ARRAY[ CASE WHEN t.tgtype & 4 > 0 THEN 'INSERT' END, CASE WHEN t.tgtype & 8 > 0 THEN 'DELETE' END, CASE WHEN t.tgtype & 16 > 0 THEN 'UPDATE' END, CASE WHEN t.tgtype & 32 > 0 THEN 'TRUNCATE' END ], ' OR ') AS events, pn.nspname AS function_schema, p.proname AS function_name, CASE t.tgenabled WHEN 'O' THEN 'ENABLED' WHEN 'D' THEN 'DISABLED' WHEN 'R' THEN 'REPLICA' WHEN 'A' THEN 'ALWAYS' END AS status, pg_get_triggerdef(t.oid) AS definition FROM pg_trigger t JOIN pg_class c ON t.tgrelid = c.oid JOIN pg_namespace n ON c.relnamespace = n.oid JOIN pg_proc p ON t.tgfoid = p.oid JOIN pg_namespace pn ON p.pronamespace = pn.oid WHERE NOT t.tgisinternal AND n.nspname = ':schema' AND t.tgname = ':name'"
                  },
                  "results": "table"
                }
              ]
            },
            {
              "id": "delete",
              "name": "Delete Trigger",
              "visible": false,
              "queries": [
                {
                  "source": {
                    "type": "sql",
                    "value": "DROP TRIGGER \":name\" ON \":schema\".\":table_name\""
                  },
                  "loader": {
                    "type": "sql",
                    "value": "SELECT ':schema' AS schema, ':name' AS name, ':table_name' AS table_name"
                  },
                  "returnToParent": true,
                  "results": null,
                  "parameters": [
                    {
                      "name": "schema",
                      "label": "Schema",
                      "type": "text",
                      "required": true,
                      "hidden": true
                    },
                    {
                      "name": "name",
                      "label": "Trigger Name",
                      "type": "text",
                      "required": true,
                      "hidden": true
                    },
                    {
                      "name": "table_name",
                      "label": "Table Name",
                      "type": "text",
                      "required": true,
                      "hidden": true
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "id": "scripts",
      "name": "Scripts",
      "icon": "file-text",
      "itemsFromState": "tabs",
      "userCreatable": true,
      "itemTemplate": {
        "id": ":id",
        "name": "Untitled",
        "icon": "file-text",
        "visible": true,
        "queries": [
          {
            "source": {
              "type": "sql",
              "value": ""
            },
            "results": "table"
          }
        ]
      }
    }
  ]
}
